<!doctype html>
<html>
<head>
   <meta charset="utf-8">
   <title>Babylon - Basic scene</title>
   <style>
      html, body {
         overflow: hidden;
         width: 100%;
         height: 100%;
         margin: 0;
         padding: 0;
      }
      #renderCanvas {
         width: 100%;
         height: 100%;
         touch-action: none;
      }
   </style>
   <script src="js/babylon.js"></script>
   <script src="js/hand.js"></script>
   <script src="js/cannon.js"></script> <!-- optional physics engine -->
</head>
<body>

   <canvas id="renderCanvas"></canvas>
   <script type="text/javascript">
      // Get the canvas element from our HTML below
      var canvas = document.querySelector("#renderCanvas");
      // Load the BABYLON 3D engine
      var engine = new BABYLON.Engine(canvas, true);
      // -------------------------------------------------------------
      // Here begins a function that we will 'call' just after it's built
      var createScene = function () {
         // Now create a basic Babylon Scene object
         var scene = new BABYLON.Scene(engine);
         // Change the scene background color to green.
         scene.clearColor = new BABYLON.Color3(0.4, 0.7, 0.9);

         // ambient color
         scene.ambientColor = new BABYLON.Color3(0.3, 0.3, 0.3);

         // This creates and positions a free camera
         var camera = new BABYLON.ArcRotateCamera("Camera", 0, 0.8, 100, BABYLON.Vector3.Zero(), scene);
         camera.lowerBetaLimit = 0.1;
         camera.upperBetaLimit = (Math.PI / 2) * 0.9;
         camera.lowerRadiusLimit = 30;
         camera.upperRadiusLimit = 150;
         camera.attachControl(canvas, true);

         // This creates a light, aiming 0,1,0 - to the sky.
         var light = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(0, 1, 0), scene);

         // Dim the light a small amount
         light.intensity = 0.8;

         // ground material
         var groundMaterial = new BABYLON.StandardMaterial("ground", scene);
         groundMaterial.diffuseTexture = new BABYLON.Texture("images/grass.jpg", scene);

				 var precision = {
            "w" : 2,
            "h" : 2
          };
          var subdivisions = {
            'h' : 8,
            'w' : 8
          };

          // ground mesh
          var groundPlane = BABYLON.Mesh.CreateGround("ground1", 200, 200, 2, scene);
          groundPlane.material = groundMaterial;
          // rotate plane
          groundPlane.position = new BABYLON.Vector3( 3, 3, 3);



          // Skybox
          var skybox = BABYLON.Mesh.CreateBox("skyBox", 800.0, scene);
          var skyboxMaterial = new BABYLON.StandardMaterial("skyBox", scene);
          skyboxMaterial.backFaceCulling = false;
          skyboxMaterial.reflectionTexture = new BABYLON.CubeTexture("textures/skybox", scene);
          skyboxMaterial.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;
          skyboxMaterial.diffuseColor = new BABYLON.Color3(0, 0, 0);
          skyboxMaterial.specularColor = new BABYLON.Color3(0, 0, 0);
          skyboxMaterial.disableLighting = true;
          skybox.material = skyboxMaterial;



         // ------morphing test --------------------------------------

          // material of morphing element
          var mat = new BABYLON.StandardMaterial("mat1", scene);
          mat.alpha = 1.0;
          mat.diffuseColor = new BABYLON.Color3(0, 0, 0);
          mat.backFaceCulling = false;
          mat.wireframe = true;


          // path function
          var pathFunction = function(k) {
            var path = [];
            for (var i = 0; i < 200; i++) {
              var x =  i - 100;
              var y = 0;
              var z = k;
              // gets the positions of the element
              path.push(new BABYLON.Vector3(x, y, z));
            }
            return path;
          };



          // ribbon creation
          var sideO = BABYLON.Mesh.BACKSIDE;
          var pathArray = [];
          for(var i = -60; i < 60; i++) {
            pathArray.push(pathFunction(i * 2));
          }
          var mesh = BABYLON.Mesh.CreateRibbon("ribbon", pathArray, false, false, 0, scene, true, sideO);
          mesh.material = mat;
          mesh.position = new BABYLON.Vector3( 3.2, 3.2, 3.2);


          // morphing



      //When user clicks the ground
  //    scene.onPointerDown = function (evt, pickResult) {
      // if the click hits the ground object, we change the impact position
  //    if (pickResult.hit) {
  //        hand.position.x = pickResult.pickedPoint.x;
  //        hand.position.y = pickResult.pickedPoint.y;
  //      }
  //  };

         // Leave this function
         return scene;
      }; // End of createScene function
      // -------------------------------------------------------------
      // Now, call the createScene function that you just finished creating
      var scene = createScene();
      // Register a render loop to repeatedly render the scene
      engine.runRenderLoop(function () {
         scene.render();
      });
      // Watch for browser/canvas resize events
      window.addEventListener("resize", function () {
         engine.resize();
      });
   </script>
</body>
</html>
