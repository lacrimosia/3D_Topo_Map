<!doctype html>
<html>
<head>
   <meta charset="utf-8">
   <title>Babylon - Basic scene</title>
   <style>
      html, body {
         overflow: hidden;
         width: 100%;
         height: 100%;
         margin: 0;
         padding: 0;
      }
      #renderCanvas {
         width: 100%;
         height: 100%;
         touch-action: none;
      }
   </style>
   <script src="js/babylon.js"></script>
   <script src="js/hand.js"></script>
   <script src="js/cannon.js"></script> <!-- optional physics engine -->
</head>
<body>

   <canvas id="renderCanvas"></canvas>
   <script type="text/javascript">
      // Get the canvas element from our HTML below
      var canvas = document.querySelector("#renderCanvas");
      // Load the BABYLON 3D engine
      var engine = new BABYLON.Engine(canvas, true);
      // -------------------------------------------------------------
      // Here begins a function that we will 'call' just after it's built
      var createScene = function () {
         // Now create a basic Babylon Scene object
         var scene = new BABYLON.Scene(engine);
         // Change the scene background color to green.
         scene.clearColor = new BABYLON.Color3(0.4, 0.7, 0.9);

         // ambient color
         scene.ambientColor = new BABYLON.Color3(0.3, 0.3, 0.3);

         // add fog to the scene
      //   scene.fogMode = BABYLON.Scene.FOGMODE_EXP;

         // This creates and positions a free camera
         var camera = new BABYLON.ArcRotateCamera("Camera", Math.PI / 2, 1.0, 110, BABYLON.Vector3.Zero(), scene);
         camera.attachControl(canvas, true);

         // This creates a light, aiming 0,1,0 - to the sky.
         var light = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(0, 1, 0), scene);

         // Dim the light a small amount
         light.intensity = 0.8;

         // ground material
         var groundMaterial = new BABYLON.StandardMaterial("ground", scene);
         groundMaterial.diffuseTexture = new BABYLON.Texture("images/grass.jpg", scene);


         //hand
         var handMaterial = new BABYLON.StandardMaterial("handmaterial", scene);
         handMaterial.diffuseTexture = new BABYLON.Texture("images/impact.png", scene);


				 var precision = {
            "w" : 2,
            "h" : 2
          };
          var subdivisions = {
            'h' : 8,
            'w' : 8
          };

          // ground mesh
          var groundPlane = BABYLON.Mesh.CreatePlane("groundPlane", 60 , scene);
          groundPlane.material = groundMaterial;
          // rotate plane
          groundPlane.rotation = new BABYLON.Vector3( Math.PI/2, 0, 0);


          // actions on mouse click
      //  groundPlane.actionManager = new BABYLON.ActionManager(scene);
      //  groundPlane.actionManager.registerAction(new BABYLON.InterpolateValueAction(BABYLON.ActionManager.OnLeftPickTrigger, light, "diffuse", BABYLON.Color3.Black(), 1000));


      var hand = BABYLON.Mesh.CreatePlane("hand", 10 , scene);
      hand.material = handMaterial;
      // rotate plane
      hand.rotation = new BABYLON.Vector3( Math.PI/2, 0, 0);
      hand.position = new BABYLON.Vector3(0, 0, -0.1);


      //When user clicks the ground
      scene.onPointerDown = function (evt, pickResult) {
      // if the click hits the ground object, we change the impact position
      if (pickResult.hit) {
          hand.position.x = pickResult.pickedPoint.x;
          hand.position.y = pickResult.pickedPoint.y;
        }
    };

      //When pointer down event is raised

      // Impact impostor
          var impact = BABYLON.Mesh.CreatePlane("impact",15, scene);
          impact.material = new BABYLON.StandardMaterial("impactMat", scene);
          impact.material.diffuseTexture = new BABYLON.Texture("images/impact.png", scene);
          impact.material.diffuseTexture.hasAlpha = false;
          impact.position = new BABYLON.Vector3( Math.PI/2, 0, 0);


     scene.onPointerDown = function (evt, pickResult) {
         // if the click hits the ground object, we change the impact position
         if (pickResult.hit) {
             impact.position.x = pickResult.pickedPoint.x;
             impact.position.y = pickResult.pickedPoint.y;
         }
     };


         // Leave this function
         return scene;
      }; // End of createScene function
      // -------------------------------------------------------------
      // Now, call the createScene function that you just finished creating
      var scene = createScene();
      // Register a render loop to repeatedly render the scene
      engine.runRenderLoop(function () {
         scene.render();
      });
      // Watch for browser/canvas resize events
      window.addEventListener("resize", function () {
         engine.resize();
      });
   </script>
</body>
</html>
